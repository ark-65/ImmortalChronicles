标题
Flutter 文字冒险《人生重开·多界版》设计方案

概要

- 以属性分配→多世界事件推进→结局为主线，支持凡界/下界/仙界跃迁与家境影响出生。
- 使用 setState 管理局部状态，SharedPreferences 持久化存档；纯本地随机事件，无联网。
- UI 简洁卡片/弹窗流：属性分配页 → 冒险主界面（事件卡 + 行动按钮 + 日志抽屉）。
- 事件引擎基于可配置 JSON（内置），支持条件判断、属性修改、世界跳转、结局触发。

核心数据与接口（决定性）

- World 分层：上三界=仙界/圣界/神界（逻辑 world=immortal，区分通过 region 标签）；下三界=灵界/人界/魔界（魔界映射 nether，灵界/人界映射 mortal）。
- PlayerState 模型：name:String, age:int, world:World, strength/intelligence/charm/luck/family:int, lifeEvents:List<LifeEventEntry>,
  alive:bool, ending:String?.
- 初始点数：30 点自由分配（可调常量），family 若≥8，出生世界有 30% 概率为 immortal，5–7 为 nether 概率 10%，否则凡界。
- LifeEventConfig 结构（内置 JSON 数组）：id, title, description, worlds:[World], minAge/maxAge, conditions（属性阈值/概率表达式），effects（属
  性增减、world 迁移、年龄增量、结局设定、日志附加）。
- 随机性：统一 Random 实例，可选 seed（若用户未提供，用当前毫秒）。存档包含 seed 以便复盘。
- 持久化键："life_save_v1"，值为 PlayerState + seed + pendingEvents 的 JSON。
- UI 入口路由：/ → AttributeSetupPage → AdventurePage; AdventurePage 通过浮层或抽屉展示 lifeEvents。

玩法与流程

1. 角色创建/属性分配：输入姓名，滑杆分配 30 点到五维；实时显示剩余点数，必须用完才可开始。
2. 出生与世界判定：根据 family 判定出生世界；写入首条 lifeEvents。年龄初始 0。
3. 回合推进：点击“继续前行”按钮，年龄至少 +1，随机抽取当前世界可用事件：
    - 先过滤 world、age、conditions；
    - 若无匹配，使用兜底事件（如“平淡一年”）。
4. 事件执行：展示事件卡（标题+描述+结果）；应用 effects 后写入日志。
5. 世界跃迁：事件可修改 world（例如凡界→下界，或家境/机缘触发仙界）并附加过渡日志。
6. 结局判定：事件可直接给 ending，或当 age >= 80 自动触发“寿终正寝”；结局后 alive=false，仅可“重开”或“查看人生回顾”。
7. 存档/读档：每次事件后自动保存；主界面提供“继续上次人生”按钮。
8. 重开机制：清空存档并回到属性分配页；保留上一轮 seed 供分享（展示在结局页）。

- 回合与行动力（适用于全手动/半自动）

- 每岁刷新基础 1 点 AP；若拥有“气运之子”体质 +1，familyScore≥95 再 +1，顶配合计 3 点/年。组 1 为事件选项（修炼/奇遇/社交等），通常消耗 1 AP；组 2 为“进入下一岁”选项，不消耗 AP。
- 当 AP=0 时，所有事件按钮禁用，只能使用“进入下一岁”（组 2）；此时进入下一岁会执行默认随机事件流程（半自动）。
- 玩家可在 AP>0 时主动选择“直接进入下一岁”（不消耗 AP，剩余 AP 作废），用于快进或半自动游玩。
- 自动/随机策略：在半自动模式下，若玩家不手动选择事件，系统按权重随机挑选可用事件直至 AP 用完或玩家跳年。
- pendingEvents 与强制剧情仍可占用当年首个事件位，消耗 1 AP；如需强制无消耗事件，可在配置中显式标记。
- 事件优先级：pending > 强制剧情 > 玩家选择/托管默认 > 随机补足；单岁最多 1 主事件 + 托管子事件。

高参与度耗时与机缘等级

- 机缘等级：SSS / SS / S / A / B / C / D / E / F，对应事件耗时与难度；SSS 级修炼/任务/渡劫可能耗时 50–100 年，低等级事件耗时 0–5 年。
- 年龄推进：进入耗时事件后按事件标注的年份批量前进，期间每年可触发“托管选项”消费 AP（如继续参悟/尝试突破/放弃），但不允许瞬时完成。
- 托管交互（示例）：
  1) 继续参悟：逐年根据体质/功法/寿元等隐式提升成功率，具体数值不明示。
  2) 尝试突破：提前结束闭关并判定突破成功率；失败可能重伤/跌境/死亡。
  3) 放弃突破：安全出关，获得少量感悟（小幅属性或悟道值）。
- AP 规则：托管期内每个年度随机事件都会消耗 1 AP；若当岁未耗尽 AP 就被动进入下一岁（碌碌无为），未用完的 AP 作废。防止零成本刷属性并保留随机性。
- 托管交互方式：玩家可勾选“继续参悟/探索”等托管策略（checkbox）；托管运行时以 2 秒/事件的速度推进，可随时手动取消，取消后在当次事件结束时退出托管。
- 长周期事件与 AP 对齐：事件若标注 10 年周期，则总计需要当年 30 AP（10 年×3 AP/年）。当年 AP 用完后自动进入下一岁继续累计，直到满足周期或玩家强行出关。若第 N 年强行出关，则按“已耗 AP / 30”比例结算收益。
- 当岁事件上限：单岁最多 1 个主事件 + 托管子事件（逐年推进）。非托管普通事件默认消耗 1 AP 并至少+1岁，若事件自带耗时>1 年，则年龄按实际耗时推进，AP 按年扣。

界面与交互

- AttributeSetupPage：姓名输入框；5 个滑杆 + 数字显示；剩余点数提示；“开始人生”按钮禁用直到分配完成。
- AdventurePage：顶部显示姓名/世界/年龄；属性条（颜色区分正负变化）；主卡片显示当前事件与结果；底部主按钮“继续前行”；右上角日志图标打开
  lifeEvents 侧抽屉；结局时切换为“重开/查看日志”。
- LifeLogDrawer：时间线列表，按事件顺序展示。
- SettingsSheet（轻量）：切换是否显示随机种子、重置存档确认。

事件配置（首批内置示例）

- 凡界：童年学习(+intelligence)，街头打架(+strength，可能受伤 -charm)，偶遇贵人(+charm/+family 概率)。
- 家境高特殊：贵族教育（仙缘+），豪门内斗（跌落下界概率）。
- 下界：险境磨砺(+strength/-charm)，冥市交易(+luck/风险)，魔族契约（跳转仙界或死亡）。
- 仙界：闭关修炼(+intelligence/+strength)，仙缘考核(失败降界)，渡劫(成功留仙界，失败死亡或跌落凡界)。
- 结局样例：庸庸碌碌、战死、飞升、富甲一方、魔道坠落。

测试与验收场景

- 属性分配：点数用完前开始按钮禁用；用完后启用。
- 出生判定：family=10 时仙界概率路径可覆盖，family=1 恒凡界。
- 事件过滤：在仙界不会抽到凡界限定事件。
- 结局流程：年龄≥80 自动结局；事件触发结局后按钮状态切换。
- 存档：中途退出再进保持年龄/属性/世界一致；重开后存档清空。
- 随机种子：使用固定 seed 时同一路径事件顺序一致。

假设与默认值

- 单人本地游戏，不做多人/云存档。
- 目标平台 Android/iOS/Web 同时支持；无平台特定功能。
- 文案与 UI 采用中文，事件文案由我们在实现时补齐首批示例。
- 不引入第三方状态管理库；仅 shared_preferences 依赖（已在 pubspec.yaml 添加时记得获取）。
- 无无障碍/国际化特定要求，如需可后续扩展。

世界层级与标签（上三界 / 下三界）

- 上三界（高阶）：神界（规则制定者，最强法则密度）、圣界（圣人居所，法则之源）、仙界（飞升目标，灵气充裕）。三者统一 world=immortal，通过 region 标识差异。
- 下三界（起始）：灵界（中等灵气，修真文明）、人界（低等灵气，凡俗聚集）、魔界（魔气弥漫，魔修之地，world=nether）。
- 事件过滤：事件配置中的 worlds 继续使用 world 枚举；若需限定具体层级，可在 conditions 增加 region=神/圣/仙/灵/人/魔 字段。
- 跃迁规则：默认 mortal⇄immortal 经由事件/结界，nether 主要来源于堕落或特定魔界召唤；神界/圣界为高阶结局或特殊事件触发。

界域跃迁途径（含顶级家族特权）

- 升界最低境界：人仙即可尝试飞升；默认突破真仙触发稳定飞升判定，依据种族/家族（上界是否有主家接引）决定落点，存在小概率落到陌生上界。\n- 跃迁方式：\n  1) 时空裂缝：随机事件，小概率送往上界，大概率坠入下界或受伤；高风险高回报。\n  2) 上界指引：上界分家上报天才，主家派人接引，直接送上界并给予资源/护道者。\n  3) 自身飞升：达标境界后飞升渡劫，成功进入上界。\n- 顶级家族特权：可自由往返下界与家族领地；升更高界仍需上述路径之一。\n- 失败回退：飞升失败按渡劫规则处理；裂缝失败可能降界、受伤或随机传送；指引事件被拒绝则 reputation 下降。
- 陌生上界落点概率：受 luck 影响，运气越低越易落到陌生上界。使用 p = clamp(5%, 30% - luck×0.2%, 30%)，luck 建议区间 0–100，超出时先截断再代入。

仙界豪门出身示例（家境拉满）

```json
{
  "event_id": "immortal_birth",
  "trigger": {"family": 100},
  "description": "你诞生于仙界天宫，仙气缭绕中传出龙吟凤鸣。作为仙帝后裔，你出生便是【真仙境】，拥有无尽寿元。",
  "effects": {
    "start_realm": "真仙境",
    "lifespan": 100000,
    "resources": {"仙灵石": 10000, "先天灵宝": 3, "护道者": ["金仙老祖", "太乙护法"]},
    "special": "immune_to_normal_death"
  },
  "followup_events": ["百岁宴·万仙来朝", "千岁·进入仙宫学府", "万岁·继承家族道统"]
}
```

家境守护与长命机制（草案）

- 保护等级映射：
  - family≥30：温饱保障（普通意外死亡免疫至 18 岁）。
  - family≥60：富贵安康（常见疾病/意外免疫至 60 岁）。
  - family≥80：延年益寿（寿元下限提升到 100 岁）。
  - family≥95：仙缘护体（自然死亡事件豁免，需特殊劫难才会死亡）。
  - family=100：与天同寿（寿元基线 99999，几乎只受剧情性死亡影响）。
- 判定逻辑：
  1) 检测死亡事件时，若 family 达到对应阈值且事件类型为自然/常规意外，则直接免疫。
  2) 若出生 world=immortal 且事件发生在下界，则视为环境不适用，默认免疫下界灾害。
  3) 特殊劫难（渡劫失败、剧情必死）不受基础保护，但可设置二次判定（如气运之子 80% 回避）。
- 数据落地：在 PlayerState 中存 `protectionLevel` 或直接依据 family 动态计算；lifeEvents 记录触发过的保护免死，用于回顾与成就。

隐藏家族与护道者规则

- 极品出身（如“仙帝之子”“世界主宰后裔”）：护道者可覆盖当世大部分威胁，对常规死亡事件视为免疫；但剧情性劫难仍需判定。
- 非极品但高调跋扈：当 family<95 且连续高调事件>2 次，触发“家族警告/灭顶危机”概率事件；可能导致 family 与 reputation 大幅下降，护道者暂时失效。
- 灭顶危机判定：根据当前 family 与“家族好感度”计算保全概率；家境越高且好感度越高，越可能举族护送主角逃遁。失败则强制 family/reputation 清零，护道者失效，并强制迁往下界或卷入裂隙（小概率上界，大概率下界）。
- 灭顶后果：清空宗门声望与资源库存（inventory 置零），成就计数保留；可在日志中标记“人走茶凉”标签。
- 护道者使用顺序：家境保护 > 特殊体质 > 护道者 > 道具复活；护道者消耗后可在特定事件补充或冷却恢复。
- 高调冷却：灭顶危机触发后进入冷却（建议 10–20 年内同类事件权重下降），同时触发“打了小的来了老的”长周期追杀链直至一方全灭或达成和解。
- 冷却与追杀参数（固化）：\n  - 高调冷却年数 = max(10, 20 - family/10)，向下取整。\n  - 追杀波次 = 1 + ceil(high_profile_count/2)，间隔 5–8 年（可随机），波次耗尽或交好即终止。
- 冷却叠加：冷却期内的新高调行为不新增波次，但会刷新冷却计时；既定波次继续执行。
- 家族好感度：范围 0–100，来源于家族/宗门任务、贡献资源、低调行事；违令、牵连家族、滥杀无辜会下降。好感度直接影响灭顶保全概率与护道者出手意愿。示例保全概率：p = clamp(10% + family×0.4% + goodwill×0.5%, 5%, 95%)。

寿元边界与延寿药

- 寿元阈值衰减：当处于当前境界寿元的 80% 以上时，境界机缘收益 -20%；90% 以上 -40%。不允许长耗时事件跨越寿元上限，需先延寿或突破。
- 延寿药品：顶级家族/高位宗门可每境界索要最多 3 次延寿，增加年份按《opportunity_tiers.md》中延寿品阶表执行；延寿次数用尽仍未突破则只能坐化或重开。
- 跨年截断：托管或长事件若将超出寿元，需提前提示并允许缩短/出关；否则视为坐化结局。
- 延寿基准：80%/90% 阈值基于“当前寿元上限”实时重算，服用延寿丹后即时刷新阈值。
- 跨境界重置：突破后延寿次数重置为新境界的配额；未用完的旧境界延寿不可累加带入。

数据结构细化

- PlayerState 持久化 JSON 字段：name、age、world、strength/intelligence/charm/luck/family、alive、ending、lifeEvents（按顺序存储 title/description/effects 摘要）、seed、pendingEvents（未消费的事件 id 队列）。
- 存档示例（缩写）：`{"name":"阿南","age":12,"world":"mortal","strength":5,"lifeEvents":[{"id":"m_01","age":1,"delta":{"intelligence":1}}],"seed":1700000000}`。
- 随机数：启动时若无存档则使用当前毫秒作为 seed，新开局/重开可在设置中选择复用上次 seed 以便复盘。

存档与日志裁剪

- lifeEvents 体量大时按 100 年分页；旧分页保留摘要/成就，详细文本可裁剪或懒加载，防止存档膨胀。
- 局域网对战/传功日志单独分簿，默认仅保留最近 N 条（可设 50），其余汇总为统计字段。
- 事件数分页：若单页事件数 >500，则自动压缩为“主事件+概要”模式，并折叠托管子事件列表。

出生与出身判定（family/luck 驱动）

- world 仍为三界枚举：mortal（人界/灵界）、nether（魔界）、immortal（仙界/圣界/神界）；出生只落在 mortal 或 immortal，通过 region 标签细分出身。
- 新增 `birthOrigin` 字段（示例：`"人界·贫寒之家"`、`"灵界·修真世家"`、`"仙界·仙帝之子"`），供事件文案与属性加成使用。
- 基础映射（familyScore 0–100）：
  - ≥90：`仙界·仙族旁支`（world=immortal，region=仙界，初始 luck +1，charm +1）。
  - 70–89：`灵界·修真世家`（world=mortal，region=灵界，初始 intelligence +1，family +1）。
  - 50–69：`灵界·普通家族`（world=mortal，region=灵界，初始 luck +1）。
  - 30–49：`人界·富庶人家`（world=mortal，region=人界，初始 family +1）。
  - 10–29：`人界·普通家庭`（world=mortal，region=人界，基础值不变）。
  - 0–9：`人界·贫寒之家`（world=mortal，region=人界，初始 strength +1，luck -1）。
- 隐藏出身：若 `familyScore==100 且 luck≥90`，则强制 `birthOrigin="仙界·仙帝之子（隐藏）"`，world=immortal，region=仙界，附加 `luck +2, charm +1`，并在 lifeEvents 写入稀有标签。
- 下调机制：若玩家选择高调入场但 familyScore<30，触发“底层反噬”事件（charm -1，luck -1，记录遗憾标签）。
- 触发时机：出生判定在属性分配完成后、年龄=0 写入首条 lifeEvents；其结果可影响后续灵根抽取权重（如灵界出身 +10% 高阶灵根概率）。

事件配置规范（JSON 内置）

- 字段：id、worlds、title、description、minAge/maxAge、conditions、effects、weight（可选，用于同一阶段加权随机）。
- conditions 支持：属性阈值（`{"strength":">=3"}`）、概率（`{"chance":0.25}`）、世界匹配（冗余校验），条件全部满足才可进入候选池。
- 识字/修炼前置：`needsLiteracy=true` 需 hasLiteracy 解锁（未识字无法读经或入宗）；`needsCultivation=true` 需 realm ≠“无”且所处阶段允许修炼。
- effects 支持：属性增减（`delta:{"strength":+2}`）、世界跃迁（`world:"immortal"`）、年龄增量（`age:+1`，默认事件后 +1）、添加日志附注（`log:"..."`）、结局（`ending:"飞升"`,`alive:false`）。
- 兜底事件：为每个 world 定义 fallback id（如 mortal_fallback），当过滤后为空时使用。
- 事件 JSON 片段示例：
  ```json
  {
    "id": "m_child_study",
    "worlds": ["mortal"],
    "title": "童年学习",
    "description": "你努力认字与算术。",
    "minAge": 6,
    "maxAge": 12,
    "conditions": {"chance": 0.6},
    "effects": {"delta": {"intelligence": 2}, "age": 1}
  }
  ```

分支与选项机制（含“大限将至”）

- 事件可带选项数组 `choices`；每项含 `id`、`label`、`effects`、`conditions`（可选）及 `followup`（选中后入 pendingEvents 队列）。
- UI 表现：事件卡在有 `choices` 时展示按钮列表，用户必须选择，其 effects 与 followup 应用后再写日志。
- 特殊节点示例“大限将至”：
  ```json
  {
    "id": "ending_daxian",
    "worlds": ["mortal","nether","immortal"],
    "title": "大限将至",
    "description": "寿元垂危，你将如何选择？",
    "minAge": 70,
    "conditions": {"chance": 0.2},
    "choices": [
      {"id":"reflect","label":"参悟人生","effects":{"delta":{"intelligence":+1},"log":"你静心回顾此生。"}},
      {"id":"closed_seclusion","label":"闭死关","effects":{"delta":{"strength":+2},"chance":0.5,"ending":"坐化成仙","alive":false}},
      {"id":"settle_regrets","label":"了却遗憾","effects":{"log":"你尝试弥补往昔缺憾。"},"followup":"resolve_regrets"}
    ]
  }
  ```
- 结局型选项：在 `effects` 中直接设置 `ending` 与 `alive:false`；日志注明玩家选择。
- 若事件本身有 `ending` 且包含 `choices`，以玩家选项结果为准。

遗憾检索与回溯

- lifeEvents 中新增 `tags` 与 `regret` 布尔标记，用于标记可能引发遗憾的事件（如“错失机缘”“亏欠亲人”）。
- 记录格式更新：`lifeEvents` 元素包含 id、age、title、summary/effects 摘要、tags:[string]、regret?:bool。
- “了却遗憾”流程：
  1) 扫描 lifeEvents，按时间倒序取 `regret=true` 或含 `tags` 中含 `regret`/`family`/`love` 等关键词的事件列表。
  2) 若列表为空，使用兜底描述“此生少有遗憾”。
  3) 将选中的遗憾事件信息渲染在弹窗；允许给出一到两个补救选项（如寻找旧人、补偿家人），这些补救选项作为 `resolve_regrets` followup 的 `choices`。
  4) 补救选项的 effects 可调整属性或直接触发特定结局（如“心愿了却，安然离世”）。
- 数据支持：持久化时 lifeEvents 保留 tags/regret，便于重启后继续回溯；pendingEvents 可存储后续补救节点 id。

交互模式取舍（半自动 vs 全手动）

- 半自动（关键节点才出现选项）：节奏紧凑、文本沉浸感强，文案与事件库压力可控；缺点是玩家掌控感略弱，需要关键节点设计足够有分量。
- 全手动（几乎每年都要选择）：参与感强、可做更多分支；但文案/事件数量呈指数增长，易重复、拖节奏，制作与平衡成本高。
- 推荐：默认半自动，辅以“高参与度模式”开关（设置页）。基础模式仅在阶段节点/里程碑触发选项（如启蒙、入宗门、渡劫、临终），高参与度模式在年份事件上额外插入少量微决策以增加操控感。
- 阶段化强制选项：按生命周期切片（童年6岁灵根检测、少年入门、修行突破、重大机缘、渡劫/大限）确保每段都有至少1–2个可选分支。
- 6岁灵根检测示例（含入场方式与检测结果联动）：
  - 高调入场 + 高品质灵根：`charm +2, luck +1`（众星捧月）。
  - 高调入场 + 垃圾灵根：`charm -1, luck -1`（被嘲讽，跳梁小丑）。
  - 普通入场：`charm +0, luck +0`，仅按灵根品质给予基础属性（如高灵根 `intelligence +1, strength +1`）。
  - 低调入场 + 高品质灵根：`intelligence +1, luck +2`（深藏不露，暗中加持）。
  - 低调入场 + 垃圾灵根：`family -1, strength +1`（受冷落但磨砺心性）。
- 实现要点：检测事件先确定灵根品质（随机或由 family/luck 影响），再根据玩家选择和品质组合映射 effects；结果与选择一起写入 lifeEvents 供后续遗憾/回溯引用。

天赋与体质设定

- 灵根层级枚举（影响修炼速度系数）：废灵根×0.2、杂灵根×0.5、真灵根×1.0、地灵根×1.5、天灵根×2.0、道体×3.0（亲近单一道）、先天道体×5.0（自带法则碎片）、混沌体×10.0（极稀有）。
- 抽取流程（默认权重，可被 family/luck 修正）：废 30%、杂 28%、真 20%、地 10%、天 6%、道体 4%、先天 1.8%、混沌 0.2%。luck 每 +2 将高阶（天体及以上）权重总和提升 10%，从低阶等比扣减。
- 结果揭示：在 6 岁灵根检测事件中一次性揭示灵根层级；若抽到道体及以上，可附带特效动画/音效以强化反馈。

特殊体质（独立稀有标签，可与灵根叠加）

- 荒古圣体：同阶战力 +200%，突破难度 ×2（稀有度 0.1%）。\n- 九转金丹：每 100 年自动升一小境界，根基 ×2（0.5%）。\n- 气运之子：奇遇概率 ×5，致死事件 80% 回避（1%）。\n- 凤凰涅槃：死亡时 30% 复活并 `charm +1`，冷却 50 年（0.8%）。\n- 先天剑骨：剑类功法速度 ×3，剑伤害 ×2（1.2%）。\n- 太阴圣体：夜间修炼 ×2，日间 ×0.7；暗系亲和（0.7%）。\n- 太阳炎体：火系伤害 ×2，火系修炼 ×1.5，怕水环境（0.7%）。\n- 木灵亲和：恢复类功效 ×2，种植/炼药额外产出（1.5%）。\n- 星辰道心：心魔判定 -50%，悟道事件收益 ×2（0.4%）。\n- 魔血觉醒：力量成长快（strength +2 起步），但 charm -1，某些正道门派拒收（1.3%）。\n- 轮回印记：每次重开可继承 20% 属性为“轮回记忆”，但早期事件难度 +1 阶（0.3%）。\n- 古阵灵眸：阵法类选择必定显示额外隐藏选项，阵法修炼 ×2（0.9%）。

体质判定与组合逻辑

- 抽取顺序：先 roll 灵根层级，再独立 roll 特殊体质；若抽中多于1个体质，只保留稀有度最高的一个（可配置为“最多2个”模式）。\n- 联动映射：灵根为“混沌体”时，体质池中仅保留稀有度 ≤1% 且属性正向的条目；“废灵根”抽中特殊体质时自动提升到“杂灵根”。\n- 体质失败补偿：连续 N 次（建议 5）未抽中特殊体质，下次稀有度整体 ×1.5（保底机制）。\n- 事件影响：\n  - 入场方式对稀有度加成：高调入场 +10% 抽中特殊体质概率但若落空，charm -1；低调入场不改概率但若抽中，附加 luck +1。\n  - 某些机缘事件可二次 roll 体质升级（如“浴火重生”事件允许太阳炎体 → 凤凰涅槃 5%）。\n- 数据记录：PlayerState 需存 `talentLevel`（枚举值）与 `specialTalents`（数组，可空），写入存档与日志，供后续条件判断与结局描述使用。\n- 文案提示：在日志与属性条旁显示简短标签（如“天灵根·荒古圣体”），并在关键事件里复述其加成以强化记忆。

修行境界体系（下三界→上三界）

- 下界主线（人/灵/魔共用早期）：炼气期（13 层，寿元 120）、筑基期（4 层，250）、金丹期（9 层，500）、元婴期（9 层，1000）、化神期（9 层，2000）。\n- 灵界中段：炼虚期（9 层，5000）、合体期（9 层，10000）、大乘期（9 层，50000）。\n- 仙界及以上：人仙→地仙→天仙→金仙→太乙金仙→大罗金仙→混元大罗金仙→圣人（各 9 层，寿元逐级提升，圣人近无限）。\n- 数据模型：`Realm{name, levels, baseLifespan, breakthroughs[]}`；`levels` 用于前中后/巅峰细分，`baseLifespan` 叠加体质/功法/丹药可延长。\n- 突破条件示例：所需资源（灵石/丹药/奇物）、试炼成功率（受 luck/体质/功法加成）、失败后果（跌境/重伤/坐化）、地域要求（如大乘→真仙需仙界或圣界试炼）。\n- 世界门槛：\n  - 元婴前多在下三界；化神后有概率触发渡劫，成功可进入灵界或仙界试炼。\n  - 达到人仙可尝试飞升；真仙及以上进入上界更稳定；太乙以上方可触碰圣界/神界。\n- 结局映射：达到混元大罗/圣人可解锁终极结局分支（证道、开辟小世界、入主圣界等）；若寿元耗尽未突破，则按当前境界触发坐化/轮回事件。

功法与修炼资源（待落地）

- 功法品质：凡级/灵级/仙级/圣级/道级，提供修炼倍率、属性侧重（力量/智力/防御/身法）。\n- 适配度：功法与灵根、体质有匹配度系数（0.5–1.5），决定修炼效率与突破成功率。\n- 资源体系：基础货币=灵石，高阶资源=仙灵石、混沌石；丹药/法宝/灵材作为突破或事件消耗；护道者视为一次性免死或加成。\n- 掉落/获得途径：家境、宗门俸禄、奇遇、任务、拍卖事件。高参与模式可在事件中选“竞拍/放弃”。\n- 数据字段建议：`techniques:[{id, name, grade, affinity, multiplier, durability?}]`，`inventory:{灵石:int, 仙灵石:int, 丹药:map, 法宝:list}`，存档持久化。\n- 养成节奏：同境界若功法倍率低则年份消耗高；高品质功法可减少年份但增加资源消耗。
- 武器与流派（新增常量表 `lib/data/weapons.dart`）\n  - 刀/剑/枪/棍/棒/斧/钺/钩/叉/镗/槊/鞭/锏/锤/抓/拐/流星/戟/戈/弓弩二十类，附典型子类与战斗定位。\n  - 家族/宗门模板可挂主武器偏好，用于事件文案与功法/法宝掉落（如火枪系家族掉落枪道秘典、枪类法宝）。\n  - 后续切磋/战斗事件可按流派判定克制或附加效果（如枪克短兵、鞭克轻甲，数值待策划）。

五行灵根与功法适配（参考《了不起的修仙模拟器》）

- 五行构成：为角色记录 `elementProfile = {金,木,水,火,土}`（总和 100%），可出现单灵根（≥80%）、双灵根、杂灵根；雷/风/冰/毒等为派生元素，需特定体质或机缘解锁。\n- 适配公式：功法标注主属性 `affinity`。修炼效率 = 基础倍率 × talentMultiplier × gradeMultiplier × affinityMatch；其中 affinityMatch = 1 + max(0, 主属性占比-0.2)×0.5。派生功法若无对应体质，affinityMatch 固定 0.3。\n- 相生相克：金克木、木克土、土克水、水克火、火克金；相生/相克可在修炼与战斗事件中提供 ±10~20% 效率或伤害修正。环境/阵法带元素标签，与功法元素同向时叠加增益，反向则削弱。\n- 灵根层级联动：天灵根及以上，为对应元素额外 +10% affinityMatch；混沌体/先天道体视为全元素 100% 适配。\n- 功法掉落与势力：宗门按主元素分类（例：剑宗=金/风，丹宗=木/土），加入后优先获得匹配功法与灵材；异属性功法需贡献或机缘任务兑换。\n- 灵材/丹药：资源附带元素标签（如“千年火髓”“玄冰玉髓”），突破/炼丹时与功法或灵根匹配可提升成功率与效率。\n- UI/日志：属性栏展示“五行灵根：金60/木20/火20”；功法卡片标注“属性：火（相生：木，克：金）”；事件日志提示因相生相克产生的额外效果。

渡劫与失败后果（高阶挑战）

- 渡劫节点：化神→炼虚、合体→大乘、大乘→真仙、太乙→大罗等；事件带 `choices`（硬抗/借宝器/请护道者/逃避）。\n- 计算：基础成功率 + luck/体质/功法加成 - 劫数系数；可用丹药/法宝提高成功率或降低伤害。\n- 失败分支：重伤（属性下降、寿元扣减）、跌境（降一层或一境）、身死（可触发轮回印记、凤凰涅槃等免死）。\n- 文案与日志：记录渡劫次数、使用的宝物、是否有护道者牺牲，便于成就统计。\n- 频率控制：同境界渡劫失败后设置冷却年份，避免刷劫。

势力、宗门与关系网（可选扩展）

- 势力类型：家族、宗门（正/魔/散修联盟）、朝廷、秘境守护者；用 `factionId` + `reputation` 数值表示关系。\n- 互动：拜师、请护道、借宝物、任务委托、驱逐/通缉；高 reputation 提升事件权重和奖励。\n- 资源/保护：加入宗门可获得功法/资源/护道者名额，但可能限制魔道行为；被逐出则 reputation 归零并触发遗憾标签。\n- 存档字段：`factions:[{id,name,type,reputation,role}]`，role 如 外门/内门/长老。\n- UI 提示：在事件卡边栏显示当前宗门与声望，选择时给出收益/代价提示。
- 家族/宗门模板字段：`id/name/elements/weapons/coreTechniques|specialties/tier`，其中 `weapons` 使用 `lib/data/weapons.dart` 的兵器大类（刀/剑/枪/棍/斧/钩/叉/鞭/锤/戟/戈/弓弩等），用于功法掉落与事件文案定向；高 tier 可有 2–3 个偏好兵器。
  - 武器填充规则（已用于模板生成）：\n    - 火/雷 主元素：首选枪、刀、戟；\n    - 金/风：首选剑、枪，其次棍/鞭；\n    - 木/土：首选棍、斧、槊；\n    - 水/阴：首选剑、鞭、弓弩；\n    - 混沌/光/圣系：剑为主，辅以所在元素的次选；\n    - 若模板未显式标注，按主元素套用上述默认，保证每个家族/宗门至少 1–2 个兵器偏好。

成就与重玩动机（简要）

- 成就类型：境界达成、稀有体质/出身、无伤渡劫、极限低家境成仙、遗憾全补全等。\n- 解锁：成就可解锁新事件/新功法/新出生背景（如“魔界流浪儿”“圣界试炼者”）。\n- 轮回加成：配合“轮回印记”体质或成就，下一世可继承少量属性或资源上限，提高重玩价值。\n- 统计：结局页展示用时（年龄）、渡劫次数、奇遇次数、护道者牺牲数等。

重生与轮回神器（世界级稀有）

- 类型与效果：\n  1) 回到过去（灵穿）：保留全部记忆与机缘提示，回到出生/某节点，肉身重置但心性与功法理解保留，所有机缘 flag 继续生效。\n  2) 随机灵穿：记忆保留，肉身/出身/界域随机，可能强可能弱；部分机缘因世界差异失效。\n  3) 灵肉双穿（未来向）：携带当前肉身与灵魂跳至未来，时代变迁导致旧人旧事大幅变化；机缘需重新解锁，但可带有限资源/功法卷轴。\n- 使用限制：世界级神器/功法，数量极少；每周目最多使用 3 次，消耗后进入冷却或永久消失。可与气运之子等免死叠加，但在免死序列末位（护道者之后）。\n- 成就上限：单周目可获得的轮回加成/继承上限需封顶（如属性继承≤20%，资源≤10%，功法槽继承 1 个），避免滚雪球。\n- 界域随机性：随机灵穿可能把玩家投到上/下界或异域，若投到不兼容世界，则机缘提示减弱或无效，需重新探索。\n- 记录与复盘：lifeEvents 需记录触发的重生类型、时间点、继承内容与失败/成功状态，便于成就与分享。

圣人证道方式（三路并存）

- 以力证道：不借天道或鸿蒙紫气，靠自身力量/法则强行破局，难度最高但上限最强，风险极大。\n- 斩三尸证道：斩善尸/恶尸/自我尸寄托先天灵宝，融合鸿蒙紫气与功德成圣（洪荒正统）。\n- 功德证道：累积无量功德 + 鸿蒙紫气直升成圣，资质要求低但战力在圣人中偏弱。\n- 其他分支（留接口）：香火神道/信仰成圣、内世界证道等可作为扩展事件线；以力证道可不依赖鸿蒙紫气，其余方式通常需要。\n- 设计落地：在高阶境界事件中加入对应分支与资源需求（鸿蒙紫气、先天灵宝、功德值、开天类奇物），并写入结局描述差异。

局域网对战与协同（可选玩法）

- 切磋约战：同一局域网内可邀请好友实时切磋，每日上限 10 次。实战能力系数 +0.01/次，封顶 0.3；每日自然衰减 0.01，战败额外 -0.02（不低于 0）。\n- 传功授法：每日 1 次，高境界玩家可向低境界玩家灌顶一套已掌握功法，需满足元素适配与功法等级限制；低境界者对道级功法最多习得 80%，单次灌输默认只灌顶 5%，并可能触发反噬事件（轻则掉血/属性，重则短期修炼效率 -20%）。\n- 生死之战：高风险 PvP，输者删档；免死链路沿用灭顶危机逻辑，若输者家族实力显著高于胜者，可由家族长老护住（消耗护道者/资源）或触发复活/重生神器，仍处免死序列末位并扣减次数；若全部免死耗尽，可由“气运之子”等体质提供最后一层概率保底。\n- 重生后继承：若在生死战触发重生神器，实战能力系数重置为 0，局域网次数重置，当天不可再发起生死战（冷却 1 天）。\n- 记录与限制：对战与传功仅在局域网同步结果，不影响单机随机；相关事件计入日志与成就，UI 需提示每日次数与风险。

事件执行流程（逻辑层）

1. 进入一回合时，若有 pendingEvents 先消费其首个事件；否则过滤当前 world、age、conditions 后按 weight/均匀随机抽取。
2. 默认年龄 +1（可被 effects.age 覆盖/叠加）。
3. 应用 effects：修改属性与 world、设置 ending/alive、写入日志摘要到 lifeEvents。
4. 若 ending 设定或 age≥80，则进入结局态，按钮文案切换为“重开/查看日志”。
5. 将最新状态连同 seed 和 pendingEvents 写入 shared_preferences 键 `life_save_v1`。
6. UI 通过 setState 刷新卡片与属性条；日志抽屉按时间线降序显示。
