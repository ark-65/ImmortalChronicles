# Flutter 文字冒险《人生重开·多界版》开发文档

## 1. 核心概念与数据结构

- World/Region：world 枚举 mortal(人/灵)、nether(魔)、immortal(仙/圣/神)；region 标签区分 神/圣/仙/灵/人/魔。
- PlayerState：name, age, world, region, strength/intelligence/charm/luck/family, alive, ending?, birthOrigin, talentLevel, specialTalents[],
  lifeEvents[], seed, pendingEvents[], protectionLevel?
- LifeEventConfig：id, title, description, worlds[], minAge/maxAge, conditions, effects, weight?, choices?, followup?, region?
- 持久化：SharedPreferences 键 life_save_v1，存 PlayerState + seed + pendingEvents。lifeEvents 含 id, age, title, summary/effects, tags[],
  regret?。
- 随机性：统一 Random，可选 seed（结局展示）。

## 2. 角色创建与出生

- 初始 30 点自由分配五维，用完才可开始。
- 出生映射 familyScore→birthOrigin：
  ≥90 仙族旁支(immortal 仙界)+luck+1/charm+1；70–89 灵界世家；50–69 灵界普通；30–49 人界富庶；10–29 人界普通；0–9 人界贫寒(strength+1, luck-1)。
  隐藏：family=100 且 luck≥90 →“仙帝之子”，附加 luck+2/charm+1，稀有标签。
- 高调入场且 family<30 触发“底层反噬”。
- 出生记录写入 lifeEvents，影响后续灵根概率（灵界出身 +10% 高阶灵根）。

## 3. 灵根与体质

- 灵根层级倍率：废0.2、杂0.5、真1.0、地1.5、天2.0、道体3.0、先天道体5.0、混沌体10.0。默认权重：30/28/20/10/6/4/1.8/0.2，luck 每+2 提升高阶权重总
  和10%并等比扣低阶。
- 五行构成 elementProfile{金木水火土}，可派生雷/风/冰/毒。适配度：affinityMatch = 1 + max(0,占比-0.2)*0.5；派生无体质则0.3。相生相克修正
  ±10~20%，环境/阵法同向叠加。
- 特殊体质 12 项（荒古圣体、九转金丹、气运之子、凤凰涅槃等），独立抽取；混沌体限定池；失败保底 N=5 次 ×1.5 权重；最多保留稀有度最高1个（可配置
  2）。
- 数据：PlayerState 存 talentLevel 与 specialTalents[]，日志显示“天灵根·荒古圣体”等标签。

## 4. 境界与寿元

- 下界：炼气13→筑基4→金丹9→元婴9→化神9。
  灵界：炼虚9→合体9→大乘9。
  仙及以上：人仙→地仙→天仙→金仙→太乙金仙→大罗金仙→混元大罗金仙→圣人（各9层，圣人近无限）。
- 突破条件：资源、成功率(luck/体质/功法)、失败后果(重伤/跌境/死)、地域门槛（大乘→真仙需仙界等）。
- 结局：混元/圣人解锁终极结局；寿元耗尽未突破则坐化/轮回。

## 5. 行动力与回合

- 每岁刷新 3 AP；组1事件消耗 AP，组2“进入下一岁”不耗 AP。AP=0 只能跳年并走默认随机事件。
- 事件优先级：pending > 强制剧情 > 玩家选择/托管默认 > 随机补足；单岁最多 1 主事件 + 托管子事件。
- 长周期事件：耗时年数×3 AP；跨年累积。强行出关按已耗 AP / 总 AP 结算收益。
- 非托管事件默认消耗 1 AP 且至少+1 岁；自带耗时>1 年按实际耗时推进并逐年扣 AP。

## 6. 机缘等级（见 docs/opportunity_tiers.md）

- SSS–F 对应耗时/奖励/风险系数占位表；修正因子：境界阶段、体质/功法适配、环境、护道者。
- 托管：2 秒/事件，checkbox 选策略；每年必扣 1 AP；未耗尽 AP 被动跳年视为作废。默认策略表已列。

## 7. 寿元与延寿

- 80%/90% 寿元阈值收益衰减 20%/40%，基于当前寿元上限实时重算。
- 延寿丹：凡+5、灵+10、仙+20、圣+50、道+100（境界内限次数详见表）。突破后次数重置，旧境界延寿不可带入。
- 长事件跨寿元需提前提示，超限则坐化。

## 8. 家境保护与灭顶危机

- 保护档位：30/60/80/95/100 对应免死与寿元下限提升；family=100 近乎仅剧情可杀。
- 免死顺序：家境保护 > 特殊体质 > 护道者 > 道具复活 >（若有）气运之子概率保底。
- 高调惩罚：family<95 且连续高调>2 触发灭顶；后果 family/reputation 清零、护道者失效、强制降界或裂隙漂流、宗门声望与资源清零。
- 冷却/追杀：冷却年数 = max(10, 20 - family/10)；追杀波次 = 1 + ceil(高调次数/2)，间隔5–8年。冷却期新高调不增波次但刷新冷却。家族好感度0–100，保
  全概率 p = clamp(10% + family×0.4% + goodwill×0.5%, 5%, 95%)。

## 9. 界域跃迁

- 人仙可尝试飞升，真仙更稳；太乙以上触及圣/神界。
- 方式：时空裂缝（高风险）、上界指引（主家接引）、自身飞升。
- 陌生上界落点：p = clamp(5%, 30% - luck×0.2%, 30%)。
- 顶级家族可自由返下界领地，但升更高界仍需路径。

## 10. 圣人证道

- 以力证道（最高上限，难度极高）、斩三尸证道（正统，需鸿蒙紫气/功德/先天灵宝）、功德证道（快捷但较弱）；接口保留香火神道、内世界证道等。高阶事件
  需携带资源需求并影响结局描述。

## 11. 重生与免死

- 重生神器：回到过去/随机灵穿/灵肉双穿（未来），每周目最多 3 次，处免死序列末位；触发后可重置 PvP 实战系数并重置当天生死战机会。继承上限：属性
  ≤20%，资源≤10%，功法槽1个。
- 轮回加成与成就：成就解锁新出身/体质/事件，结局页显示统计。

## 12. PvP 局域网玩法（可选）

- 切磋：每日 10 次，实战系数 +0.01/次，封顶 0.3；每日衰减 0.01，战败额外 -0.02。
- 传功：每日 1 次，需元素/等级适配；道级功法低境界习得≤80%，单次约5%，可能反噬（伤害或短期修炼效率 -20%）。
- 生死战：输者删档；按免死序列处理，耗尽后气运之子可概率保底。
- 记录与次数重置：重生后实战系数与当日次数重置；日志与成就记录保持。

## 13. 日志与存档管理

- lifeEvents 按 100 年分页，>500 事件压缩为“主事件+概要”，托管子事件折叠。局域网日志单独分簿，仅保留最近 N=50 条，余量汇总为统计。

## 14. 事件与数值落地提醒

- 机缘等级具体数值、延寿丹掉落/成本、家族好感度涨跌量、环境/阵法表等可在数值策划阶段微调；核心逻辑已闭环。
